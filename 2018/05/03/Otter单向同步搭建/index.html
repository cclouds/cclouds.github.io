
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Otter单向同步搭建 | cclouds</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="cclouds">
    

    
    <meta name="description" content="##1.准备阶段 ###1.1 环境虚拟机A ：192.168.1.247 虚拟机B ：192.168.1.206 系统：Centos6.5 JDK：OpenJDK 1.8.0（A、B都要安装） DB：MySQL 5.7.20，TIDB ZooKeeper：3.4.11（只装A机） Otter Manager：4.2.14 （只装A机） Otter Node：4.2.14（A、B都要安装） Ari">
<meta name="keywords" content="Otter">
<meta property="og:type" content="article">
<meta property="og:title" content="Otter单向同步搭建">
<meta property="og:url" content="http://www.cclouds.me/2018/05/03/Otter单向同步搭建/index.html">
<meta property="og:site_name" content="cclouds">
<meta property="og:description" content="##1.准备阶段 ###1.1 环境虚拟机A ：192.168.1.247 虚拟机B ：192.168.1.206 系统：Centos6.5 JDK：OpenJDK 1.8.0（A、B都要安装） DB：MySQL 5.7.20，TIDB ZooKeeper：3.4.11（只装A机） Otter Manager：4.2.14 （只装A机） Otter Node：4.2.14（A、B都要安装） Ari">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/11062458.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/55020366.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/23892310.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/91226122.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/454297.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/10329120.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/24914958.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/5780572.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/44594745.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/72950747.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/89958345.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/42588141.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/78915596.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/91732312.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/82360081.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/65817238.jpg">
<meta property="og:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/40444312.jpg">
<meta property="og:updated_time" content="2018-05-04T08:59:57.338Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Otter单向同步搭建">
<meta name="twitter:description" content="##1.准备阶段 ###1.1 环境虚拟机A ：192.168.1.247 虚拟机B ：192.168.1.206 系统：Centos6.5 JDK：OpenJDK 1.8.0（A、B都要安装） DB：MySQL 5.7.20，TIDB ZooKeeper：3.4.11（只装A机） Otter Manager：4.2.14 （只装A机） Otter Node：4.2.14（A、B都要安装） Ari">
<meta name="twitter:image" content="http://or5xsfurn.bkt.clouddn.com/18-5-4/11062458.jpg">

    
    <link rel="alternative" href="/atom.xml" title="cclouds" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/ico.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/cclouds.JPG" alt="cclouds" title="cclouds"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="cclouds">cclouds</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">archives</a></li>
					
						<li><a href="/tags">tags</a></li>
					
						<li><a href="/about">about</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:www.cclouds.me">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/05/03/Otter单向同步搭建/" title="Otter单向同步搭建" itemprop="url">Otter单向同步搭建</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="cclouds" target="_blank" itemprop="author">cclouds</a>
		
  <p class="article-time">
    <time datetime="2018-05-03T07:56:28.000Z" itemprop="datePublished"> 发表于 2018-05-03</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-启动"><span class="toc-number">1.</span> <span class="toc-text">1.3 启动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-启动ZooKeeper"><span class="toc-number">1.1.</span> <span class="toc-text">1.3.1 启动ZooKeeper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-启动Otter-Manager"><span class="toc-number">1.2.</span> <span class="toc-text">1.3.1 启动Otter Manager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-启动Otter-Node"><span class="toc-number">1.3.</span> <span class="toc-text">1.3.1 启动Otter Node</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-数据源配置"><span class="toc-number">1.4.</span> <span class="toc-text">1.4.3 数据源配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-4-数据表配置"><span class="toc-number">1.5.</span> <span class="toc-text">1.4.4 数据表配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-5-Canal配置"><span class="toc-number">1.6.</span> <span class="toc-text">1.4.5 Canal配置</span></a></li></ol></li></ol>
		
		</div>
		
		<p>##1.准备阶段</p>
<p>###1.1 环境<br>虚拟机A ：192.168.1.247</p>
<p>虚拟机B ：192.168.1.206</p>
<p>系统：Centos6.5</p>
<p>JDK：OpenJDK 1.8.0（A、B都要安装）</p>
<p>DB：MySQL 5.7.20，TIDB</p>
<p>ZooKeeper：3.4.11（只装A机）</p>
<p>Otter Manager：4.2.14 （只装A机）</p>
<p>Otter Node：4.2.14（A、B都要安装）</p>
<p>Aria2: （A、B都要安装）</p>
<p> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/11062458.jpg" alt=""></p>
<p>###1.2 安装环境</p>
<p>####1.2.1安装JDK</p>
<p><strong>解压</strong></p>
<p>rpm -ivh jdk-8u151-linux-x64.rpm</p>
<p><strong>配置环境变量</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"># 要最后加上下面三行</span><br><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_151/</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br></pre></td></tr></table></figure>
<p><strong>使环境变量生效</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<p><strong>查看版本</strong><br>java -version</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java version &quot;1.8.0_151&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_151-b12)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.151-b12, mixed mode)</span><br></pre></td></tr></table></figure>
<p>####1.2.2安装mysql<br><strong>查看是否已经安装mysql</strong><br>rpm -qa | grep mysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql-libs-5.1.73-3.el6_5.x86_64</span><br></pre></td></tr></table></figure></p>
<p><strong>卸载</strong></p>
<p>yum -y remove mysql-libs-5.1.73-3.el6_5.x86_64</p>
<p><strong>解压tar文件</strong><br>命令<br>tar -xvf mysql-5.7.13-1.el6.x86_64.rpm-bundle.tar</p>
<p>执行结果</p>
<p> mysql-community-client-5.7.13-1.el6.x86_64.rpm<br> mysql-community-common-5.7.13-1.el6.x86_64.rpm<br> mysql-community-devel-5.7.13-1.el6.x86_64.rpm<br> mysql-community-embedded-5.7.13-1.el6.x86_64.rpm<br> mysql-community-embedded-devel-5.7.13-1.el6.x86_64.rpm<br> mysql-community-libs-5.7.13-1.el6.x86_64.rpm<br> mysql-community-libs-compat-5.7.13-1.el6.x86_64.rpm<br> mysql-community-server-5.7.13-1.el6.x86_64.rpm<br> mysql-community-test-5.7.13-1.el6.x86_64.rpm</p>
<p><strong> 安装依赖组件</strong></p>
<p>yum -y install make gcc-c++ cmake bison-devel ncurses-devel libaio libaio-devel</p>
<p><strong>安装mysql组件</strong></p>
<p>经过上面的解压操作，我们得到了很多<code>rpm</code>文件。但是我们不需要这么多，我们只需要安装一下四个组件就可以了：</p>
<blockquote>
<p>mysql-community-common-5.7.19-1.el7.x86_64.rpm<br>mysql-community-libs-5.7.19-1.el7.x86_64.rpm<br>mysql-community-client-5.7.19-1.el7.x86_64.rpm<br>mysql-community-server-5.7.19-1.el7.x86_64.rpm</p>
</blockquote>
<p>因为具有<strong>依赖关系</strong>，所以我们需要按顺序执行。<br>用<code>rpm -ivh 文件名</code>就能安装相应的组件。<br>在执行server的时候，需要依赖安装一些工具组件，已经在上文有说明了</p>
<ul>
<li>安装命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh mysql-community-common-5.7.13-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-libs-5.7.13-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-client-5.7.13-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-server-5.7.13-1.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>
<ul>
<li>执行过程</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@trade_kf downloads]# rpm -ivh mysql-community-common-5.7.13-1.el6.x86_64.rpm</span><br><span class="line">warning: mysql-community-common-5.7.13-1.el6.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">Preparing...                ########################################### [100%]</span><br><span class="line">   1:mysql-community-common ########################################### [100%]</span><br><span class="line">[root@trade_kf downloads]# rpm -ivh mysql-community-libs-5.7.13-1.el6.x86_64.rpm</span><br><span class="line">warning: mysql-community-libs-5.7.13-1.el6.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">Preparing...                ########################################### [100%]</span><br><span class="line">   1:mysql-community-libs   ########################################### [100%]</span><br><span class="line">[root@trade_kf downloads]# rpm -ivh mysql-community-client-5.7.13-1.el6.x86_64.rpm</span><br><span class="line">warning: mysql-community-client-5.7.13-1.el6.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">Preparing...                ########################################### [100%]</span><br><span class="line">   1:mysql-community-client ########################################### [100%]</span><br><span class="line">[root@trade_kf downloads]# rpm -ivh mysql-community-server-5.7.13-1.el6.x86_64.rpm </span><br><span class="line">warning: mysql-community-server-5.7.13-1.el6.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY</span><br><span class="line">Preparing...                ########################################### [100%]</span><br><span class="line">   1:mysql-community-server ########################################### [100%]</span><br></pre></td></tr></table></figure>
<p><strong>初始化</strong></p>
<p>　　为了保证数据库目录为与文件的所有者为 mysql 登陆用户，如果你是以 root 身份运行 mysql 服务，需要执行下面的命令初始化</p>
<p>mysqld –initialize –user=mysql</p>
<p>　　另外 –initialize 选项默认以“安全”模式来初始化，则会为 root 用户生成一个密码并将该密码标记为过期，登陆后你需要设置一个新的密码，而使用 –initialize-insecure 命令则不使用安全模式，则不会为 root 用户生成一个密码，这里演示使用的 –initialize 初始化的，会生成一个 root 账户密码，密码在log文件里。</p>
<p>vim /var/log/mysqld.log</p>
<p> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/55020366.jpg" alt=""></p>
<p><strong>启动MySQL</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[root@trade_kf downloads]# service mysqld start</span><br><span class="line">Starting mysqld:                                           [  OK  ]</span><br></pre></td></tr></table></figure>
<p><strong>登录MySQL</strong></p>
<p>mysql -u root -p</p>
<p>密码为图片标红的</p>
<p><strong>登陆MySQL并修改root密码</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msql&gt;alter user &apos;root&apos;@&apos;localhost&apos; identified by &apos;zzjr#2015&apos;;</span><br><span class="line"></span><br><span class="line">mysql&gt;use mysql;</span><br><span class="line"></span><br><span class="line">msyql&gt;update user set user.Host=&apos;%&apos; where user.User=&apos;root&apos;;</span><br><span class="line"></span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line"></span><br><span class="line">mysql&gt;quit</span><br></pre></td></tr></table></figure>
<p><strong>修改配置文件</strong><br>vi /etc/my.cnf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">character-set-server=utf8</span><br><span class="line">log-bin=mysql-bin  </span><br><span class="line">binlog-format=ROW  </span><br><span class="line">server-id=1 #A,B需要设置成不一样的id</span><br></pre></td></tr></table></figure></p>
<p><strong>重新登录mysql</strong></p>
<p>####1.2.3 安装配置zookeeper<br><strong>解压</strong></p>
<p>tar zxvf zookeeper-3.4.11.tar.gz -C /usr/local/otter/</p>
<p><strong>重命名</strong><br>解压可见conf文件夹下有一个zoo_sample.cfg的文件，重命名为zoo.cfg<br>mv zoo_sample.cfg zoo.cfg</p>
<p><strong>修改下配置</strong><br>vi zoo.cfg<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataDir=../datas</span><br><span class="line">dataLogDir=../logs</span><br></pre></td></tr></table></figure></p>
<p>####1.2.4 安装Otter Manager</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@trade_kf otter]# mkdir manager</span><br><span class="line">[root@trade_kf otter]# cd downloads/</span><br><span class="line">[root@trade_kf downloads]# tar zxvf manager.deployer-4.2.14.tar.gz -C /usr/local/otter/manager/</span><br></pre></td></tr></table></figure>
<p>修改vim conf/otter.properties 配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">otter.domainName = 192.168.1.247</span><br><span class="line">## otter manager http port</span><br><span class="line">otter.port = 9000</span><br><span class="line">## jetty web config xml</span><br><span class="line">otter.jetty = jetty.xml</span><br><span class="line"></span><br><span class="line">## otter manager database config</span><br><span class="line">otter.database.driver.class.name = com.mysql.jdbc.Driver</span><br><span class="line">otter.database.driver.url = jdbc:mysql://192.168.1.247:3306/otter</span><br><span class="line">otter.database.driver.username = root</span><br><span class="line">otter.database.driver.password = zzjr#2015</span><br><span class="line"></span><br><span class="line">## otter communication port</span><br><span class="line">otter.communication.manager.port = 1099</span><br><span class="line"></span><br><span class="line">## otter communication pool size</span><br><span class="line">otter.communication.pool.size = 10</span><br><span class="line"></span><br><span class="line">## default zookeeper address</span><br><span class="line">otter.zookeeper.cluster.default = 192.168.1.247:2181</span><br><span class="line">## default zookeeper sesstion timeout = 60s</span><br><span class="line">otter.zookeeper.sessionTimeout = 60000</span><br><span class="line"></span><br><span class="line">## otter arbitrate connect manager config</span><br><span class="line">otter.manager.address = $&#123;otter.domainName&#125;:$&#123;otter.communication.manager.port&#125;</span><br><span class="line"></span><br><span class="line">## should run in product mode , true/false</span><br><span class="line">otter.manager.productionMode = true</span><br><span class="line"></span><br><span class="line">## self-monitor enable or disable</span><br><span class="line">otter.manager.monitor.self.enable = true</span><br><span class="line">## self-montir interval , default 120s</span><br><span class="line">otter.manager.monitor.self.interval = 120</span><br><span class="line">## auto-recovery paused enable or disable</span><br><span class="line">otter.manager.monitor.recovery.paused = true</span><br><span class="line"># manager email user config</span><br><span class="line">otter.manager.monitor.email.host = smtp.gmail.com</span><br><span class="line">otter.manager.monitor.email.username =</span><br><span class="line">otter.manager.monitor.email.password =</span><br><span class="line">otter.manager.monitor.email.stmp.port = 465</span><br></pre></td></tr></table></figure></p>
<p>####1.2.4 安装Otter Node</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@trade_kf otter]# mkdir node</span><br><span class="line">[root@trade_kf otter]# cd downloads/</span><br><span class="line">[root@trade_kf downloads]# tar zxvf node.deployer-4.2.14.tar.gz -C /usr/local/otter/node/</span><br></pre></td></tr></table></figure>
<p>修改conf文件夹下otter.properties文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">otter.nodeHome = ../</span><br><span class="line"></span><br><span class="line">## otter node dir</span><br><span class="line">otter.htdocs.dir = $&#123;otter.nodeHome&#125;/htdocs</span><br><span class="line">otter.download.dir = $&#123;otter.nodeHome&#125;/download</span><br><span class="line">otter.extend.dir= $&#123;otter.nodeHome&#125;/extend</span><br><span class="line"></span><br><span class="line">## default zookeeper sesstion timeout = 60s</span><br><span class="line">otter.zookeeper.sessionTimeout = 60000</span><br><span class="line"></span><br><span class="line">## otter communication pool size</span><br><span class="line">otter.communication.pool.size = 10</span><br><span class="line"></span><br><span class="line">## otter arbitrate &amp; node connect manager config</span><br><span class="line">otter.manager.address = 192.168.1.247:1099</span><br></pre></td></tr></table></figure></p>
<p>conf文件夹下创建一个新的配置文件，命名为nid，写入node id，A机为1，B机为2.<br>echo 1 &gt; nid</p>
<p>####1.2.4 安装aria2</p>
<p>rpm -ivh gnutls-2.12.23-21.el6.x86_64.rpm </p>
<p>rpm -ivh nettle-2.2-1.el6.rf.x86_64.rpm </p>
<p>rpm -ivh aria2-1.16.4-1.el6.rf.x86_64.rpm </p>
<h3 id="1-3-启动"><a href="#1-3-启动" class="headerlink" title="1.3 启动"></a>1.3 启动</h3><h4 id="1-3-1-启动ZooKeeper"><a href="#1-3-1-启动ZooKeeper" class="headerlink" title="1.3.1 启动ZooKeeper"></a>1.3.1 启动ZooKeeper</h4><p>进入ZooKeeper目录下的bin文件夹，执行以下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash zkServer.sh start</span><br></pre></td></tr></table></figure>
<h4 id="1-3-1-启动Otter-Manager"><a href="#1-3-1-启动Otter-Manager" class="headerlink" title="1.3.1 启动Otter Manager"></a>1.3.1 启动Otter Manager</h4><p>在A机中执行以下数据库语句，创建Otter库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE /*!32312 IF NOT EXISTS*/ `otter` /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_bin */;</span><br><span class="line"> </span><br><span class="line">USE `otter`;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `ALARM_RULE` (</span><br><span class="line">  `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `MONITOR_NAME` varchar(1024) DEFAULT NULL,</span><br><span class="line">  `RECEIVER_KEY` varchar(1024) DEFAULT NULL,</span><br><span class="line">  `STATUS` varchar(32) DEFAULT NULL,</span><br><span class="line">  `PIPELINE_ID` bigint(20) NOT NULL,</span><br><span class="line">  `DESCRIPTION` varchar(256) DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  `MATCH_VALUE` varchar(1024) DEFAULT NULL,</span><br><span class="line">  `PARAMETERS` text DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `AUTOKEEPER_CLUSTER` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `CLUSTER_NAME` varchar(200) NOT NULL,</span><br><span class="line">  `SERVER_LIST` varchar(1024) NOT NULL,</span><br><span class="line">  `DESCRIPTION` varchar(200) DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `CANAL` (</span><br><span class="line">  `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `NAME` varchar(200) DEFAULT NULL,</span><br><span class="line">  `DESCRIPTION` varchar(200) DEFAULT NULL,</span><br><span class="line">  `PARAMETERS` text DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  UNIQUE KEY `CANALUNIQUE` (`NAME`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `CHANNEL` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `NAME` varchar(200) NOT NULL,</span><br><span class="line">  `DESCRIPTION` varchar(200) DEFAULT NULL,</span><br><span class="line">  `PARAMETERS` text DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  UNIQUE KEY `CHANNELUNIQUE` (`NAME`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `COLUMN_PAIR` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `SOURCE_COLUMN` varchar(200) DEFAULT NULL,</span><br><span class="line">  `TARGET_COLUMN` varchar(200) DEFAULT NULL,</span><br><span class="line">  `DATA_MEDIA_PAIR_ID` bigint(20) NOT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `idx_DATA_MEDIA_PAIR_ID` (`DATA_MEDIA_PAIR_ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `COLUMN_PAIR_GROUP` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `DATA_MEDIA_PAIR_ID` bigint(20) NOT NULL,</span><br><span class="line">  `COLUMN_PAIR_CONTENT` text DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `idx_DATA_MEDIA_PAIR_ID` (`DATA_MEDIA_PAIR_ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `DATA_MEDIA` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `NAME` varchar(200) NOT NULL,</span><br><span class="line">  `NAMESPACE` varchar(200) NOT NULL,</span><br><span class="line">  `PROPERTIES` varchar(1000) NOT NULL,</span><br><span class="line">  `DATA_MEDIA_SOURCE_ID` bigint(20) NOT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  UNIQUE KEY `DATAMEDIAUNIQUE` (`NAME`,`NAMESPACE`,`DATA_MEDIA_SOURCE_ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `DATA_MEDIA_PAIR` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `PULLWEIGHT` bigint(20) DEFAULT NULL,</span><br><span class="line">  `PUSHWEIGHT` bigint(20) DEFAULT NULL,</span><br><span class="line">  `RESOLVER` text DEFAULT NULL,</span><br><span class="line">  `FILTER` text DEFAULT NULL,</span><br><span class="line">  `SOURCE_DATA_MEDIA_ID` bigint(20) DEFAULT NULL,</span><br><span class="line">  `TARGET_DATA_MEDIA_ID` bigint(20) DEFAULT NULL,</span><br><span class="line">  `PIPELINE_ID` bigint(20) NOT NULL,</span><br><span class="line">  `COLUMN_PAIR_MODE` varchar(20) DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `idx_PipelineID` (`PIPELINE_ID`,`ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `DATA_MEDIA_SOURCE` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `NAME` varchar(200) NOT NULL,</span><br><span class="line">  `TYPE` varchar(20) NOT NULL,</span><br><span class="line">  `PROPERTIES` varchar(1000) NOT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  UNIQUE KEY `DATAMEDIASOURCEUNIQUE` (`NAME`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `DELAY_STAT` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `DELAY_TIME` int(21) NOT NULL,</span><br><span class="line">  `DELAY_NUMBER` bigint(20) NOT NULL,</span><br><span class="line">  `PIPELINE_ID` bigint(20) NOT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `idx_PipelineID_GmtModified_ID` (`PIPELINE_ID`,`GMT_MODIFIED`,`ID`),</span><br><span class="line">  KEY `idx_Pipeline_GmtCreate` (`PIPELINE_ID`,`GMT_CREATE`),</span><br><span class="line">  KEY `idx_GmtCreate_id` (`GMT_CREATE`,`ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `LOG_RECORD` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `NID` varchar(200) DEFAULT NULL,</span><br><span class="line">  `CHANNEL_ID` varchar(200) NOT NULL,</span><br><span class="line">  `PIPELINE_ID` varchar(200) NOT NULL,</span><br><span class="line">  `TITLE` varchar(1000) DEFAULT NULL,</span><br><span class="line">  `MESSAGE` text DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `logRecord_pipelineId` (`PIPELINE_ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `NODE` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `NAME` varchar(200) NOT NULL,</span><br><span class="line">  `IP` varchar(200) NOT NULL,</span><br><span class="line">  `PORT` bigint(20) NOT NULL,</span><br><span class="line">  `DESCRIPTION` varchar(200) DEFAULT NULL,</span><br><span class="line">  `PARAMETERS` text DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  UNIQUE KEY `NODEUNIQUE` (`NAME`,`IP`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `PIPELINE` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `NAME` varchar(200) NOT NULL,</span><br><span class="line">  `DESCRIPTION` varchar(200) DEFAULT NULL,</span><br><span class="line">  `PARAMETERS` text DEFAULT NULL,</span><br><span class="line">  `CHANNEL_ID` bigint(20) NOT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  UNIQUE KEY `PIPELINEUNIQUE` (`NAME`,`CHANNEL_ID`),</span><br><span class="line">  KEY `idx_ChannelID` (`CHANNEL_ID`,`ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `PIPELINE_NODE_RELATION` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `NODE_ID` bigint(20) NOT NULL,</span><br><span class="line">  `PIPELINE_ID` bigint(20) NOT NULL,</span><br><span class="line">  `LOCATION` varchar(20) NOT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `idx_PipelineID` (`PIPELINE_ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `SYSTEM_PARAMETER` (</span><br><span class="line">  `ID` bigint(20) unsigned NOT NULL,</span><br><span class="line">  `VALUE` text DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `TABLE_HISTORY_STAT` (</span><br><span class="line">  `ID` bigint(20) unsigned NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `FILE_SIZE` bigint(20) DEFAULT NULL,</span><br><span class="line">  `FILE_COUNT` bigint(20) DEFAULT NULL,</span><br><span class="line">  `INSERT_COUNT` bigint(20) DEFAULT NULL,</span><br><span class="line">  `UPDATE_COUNT` bigint(20) DEFAULT NULL,</span><br><span class="line">  `DELETE_COUNT` bigint(20) DEFAULT NULL,</span><br><span class="line">  `DATA_MEDIA_PAIR_ID` bigint(20) DEFAULT NULL,</span><br><span class="line">  `PIPELINE_ID` bigint(20) DEFAULT NULL,</span><br><span class="line">  `START_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `END_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `idx_DATA_MEDIA_PAIR_ID_END_TIME` (`DATA_MEDIA_PAIR_ID`,`END_TIME`),</span><br><span class="line">  KEY `idx_GmtCreate_id` (`GMT_CREATE`,`ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `TABLE_STAT` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `FILE_SIZE` bigint(20) NOT NULL,</span><br><span class="line">  `FILE_COUNT` bigint(20) NOT NULL,</span><br><span class="line">  `INSERT_COUNT` bigint(20) NOT NULL,</span><br><span class="line">  `UPDATE_COUNT` bigint(20) NOT NULL,</span><br><span class="line">  `DELETE_COUNT` bigint(20) NOT NULL,</span><br><span class="line">  `DATA_MEDIA_PAIR_ID` bigint(20) NOT NULL,</span><br><span class="line">  `PIPELINE_ID` bigint(20) NOT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `idx_PipelineID_DataMediaPairID` (`PIPELINE_ID`,`DATA_MEDIA_PAIR_ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `THROUGHPUT_STAT` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `TYPE` varchar(20) NOT NULL,</span><br><span class="line">  `NUMBER` bigint(20) NOT NULL,</span><br><span class="line">  `SIZE` bigint(20) NOT NULL,</span><br><span class="line">  `PIPELINE_ID` bigint(20) NOT NULL,</span><br><span class="line">  `START_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `END_TIME` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `idx_PipelineID_Type_GmtCreate_ID` (`PIPELINE_ID`,`TYPE`,`GMT_CREATE`,`ID`),</span><br><span class="line">  KEY `idx_PipelineID_Type_EndTime_ID` (`PIPELINE_ID`,`TYPE`,`END_TIME`,`ID`),</span><br><span class="line">  KEY `idx_GmtCreate_id` (`GMT_CREATE`,`ID`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE `USER` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `USERNAME` varchar(20) NOT NULL,</span><br><span class="line">  `PASSWORD` varchar(20) NOT NULL,</span><br><span class="line">  `AUTHORIZETYPE` varchar(20) NOT NULL,</span><br><span class="line">  `DEPARTMENT` varchar(20) NOT NULL,</span><br><span class="line">  `REALNAME` varchar(20) NOT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  UNIQUE KEY `USERUNIQUE` (`USERNAME`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line">CREATE TABLE  `DATA_MATRIX` (</span><br><span class="line">  `ID` bigint(20) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `GROUP_KEY` varchar(200) DEFAULT NULL,</span><br><span class="line">  `MASTER` varchar(200) DEFAULT NULL,</span><br><span class="line">  `SLAVE` varchar(200) DEFAULT NULL,</span><br><span class="line">  `DESCRIPTION` varchar(200) DEFAULT NULL,</span><br><span class="line">  `GMT_CREATE` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  `GMT_MODIFIED` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `GROUPKEY` (`GROUP_KEY`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">insert into USER(ID,USERNAME,PASSWORD,AUTHORIZETYPE,DEPARTMENT,REALNAME,GMT_CREATE,GMT_MODIFIED) values(null,&apos;admin&apos;,&apos;801fc357a5a74743894a&apos;,&apos;ADMIN&apos;,&apos;admin&apos;,&apos;admin&apos;,now(),now());</span><br><span class="line">insert into USER(ID,USERNAME,PASSWORD,AUTHORIZETYPE,DEPARTMENT,REALNAME,GMT_CREATE,GMT_MODIFIED) values(null,&apos;guest&apos;,&apos;471e02a154a2121dc577&apos;,&apos;OPERATOR&apos;,&apos;guest&apos;,&apos;guest&apos;,now(),now());</span><br></pre></td></tr></table></figure>
<p>进入Otter Manager 下的bin目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash startup.sh</span><br></pre></td></tr></table></figure>
<p>这时等待数秒，Otter Manager站点已启动，可以访问<a href="http://192.168.1.247:9000配置Otter" target="_blank" rel="noopener">http://192.168.1.247:9000配置Otter</a> Node 的信息了。</p>
<h4 id="1-3-1-启动Otter-Node"><a href="#1-3-1-启动Otter-Node" class="headerlink" title="1.3.1 启动Otter Node"></a>1.3.1 启动Otter Node</h4><p>进入Otter Node下的bin目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash startup.sh</span><br></pre></td></tr></table></figure></p>
<p>###1.4 配置<br>进入Otter Manager站点后，使用账号：admin，密码：admin（默认），获得超级管理员权限。</p>
<p>####1.4.1 ZooKeeper配置<br>机器管理  –&gt;  ZooKeeper管理 ，添加，保存，如下图<br> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/23892310.jpg" alt=""></p>
<p> ####1.4.2 Node配置<br> 机器管理  –&gt;  Node管理 ，添加，保存（2次，A机一个Node，B机一个Node），如下图（名称和IP需要根据不同机器修改）<br>  <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/91226122.jpg" alt=""></p>
<p>  <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/454297.jpg" alt=""></p>
<p>最后可在Node管理列表中看见，其中序号即我们上面安装过程中写入的nid文件的id号，配置好之后，即可启动Otter Node<br>  <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/10329120.jpg" alt=""></p>
<h4 id="1-4-3-数据源配置"><a href="#1-4-3-数据源配置" class="headerlink" title="1.4.3 数据源配置"></a>1.4.3 数据源配置</h4><p>配置管理  –&gt;  数据源配置，配置A机、B机两个MySQL 数据源</p>
<p> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/24914958.jpg" alt=""></p>
<p>配置完成后可见配置列表<br> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/5780572.jpg" alt=""></p>
<h4 id="1-4-4-数据表配置"><a href="#1-4-4-数据表配置" class="headerlink" title="1.4.4 数据表配置"></a>1.4.4 数据表配置</h4><p>配置管理  –&gt;  数据表配置，配置A机、B机两个MySQL 数据源所需要同步的数据表（自己的数据库，我这里新建test库），其中table name配置如果想同步所有表则配置为.*，否则则配置对应表名即可<br> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/44594745.jpg" alt=""></p>
<p> 配置完成后可见配置列表</p>
<p> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/72950747.jpg" alt=""></p>
<h4 id="1-4-5-Canal配置"><a href="#1-4-5-Canal配置" class="headerlink" title="1.4.5 Canal配置"></a>1.4.5 Canal配置</h4><p>将canal看作是A、B两机的从库即可，github上解释道，canal模拟mysql slave的交互协议，伪装自己为mysql slave，向mysql master发送dump协议。</p>
<p>配置管理  –&gt;  canal配置，配置A机canal。配置如下，其他使用默认配置。</p>
<p>位点信息分别在A机器MySQL执行以下语句获取<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br><span class="line">select unix_timestamp(now());</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/89958345.jpg" alt=""></p>
<p> 配置完成后可见配置列表<br>  <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/42588141.jpg" alt=""></p>
<p>####1.4.6 同步任务配置<br>同步管理 –&gt;  Channel管理 ，添加一个Channel<br> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/78915596.jpg" alt=""></p>
<p> 添加后，点击进入Pipeline管理<br> <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/91732312.jpg" alt=""></p>
<p> 添加Pipeline，如图。<br>  <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/82360081.jpg" alt=""></p>
<p>  <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/65817238.jpg" alt=""></p>
<p>  配置完成。到Channel管理中开启同步任务<br>   <img src="http://or5xsfurn.bkt.clouddn.com/18-5-4/40444312.jpg" alt=""></p>
<p>   在A库执行下面sql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `AA_test` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(255) NOT NULL,</span><br><span class="line">  `password` varchar(255) NOT NULL,</span><br><span class="line">  `email` varchar(255) NOT NULL,</span><br><span class="line">  `phone` varchar(255) NOT NULL,</span><br><span class="line">  `time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<p>B库同步创建AA_test</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Otter/">Otter</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.cclouds.me/2018/05/03/Otter单向同步搭建/" data-title="Otter单向同步搭建 | cclouds" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2018/01/26/更换电脑怎么部署hexo/"  title="更换电脑怎么部署hexo">
 <strong>下一篇：</strong><br/> 
 <span>更换电脑怎么部署hexo
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-启动"><span class="toc-number">1.</span> <span class="toc-text">1.3 启动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-启动ZooKeeper"><span class="toc-number">1.1.</span> <span class="toc-text">1.3.1 启动ZooKeeper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-启动Otter-Manager"><span class="toc-number">1.2.</span> <span class="toc-text">1.3.1 启动Otter Manager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-启动Otter-Node"><span class="toc-number">1.3.</span> <span class="toc-text">1.3.1 启动Otter Node</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-数据源配置"><span class="toc-number">1.4.</span> <span class="toc-text">1.4.3 数据源配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-4-数据表配置"><span class="toc-number">1.5.</span> <span class="toc-text">1.4.4 数据表配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-5-Canal配置"><span class="toc-number">1.6.</span> <span class="toc-text">1.4.5 Canal配置</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/设计模式/" title="设计模式">设计模式<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/hexo系列/" title="hexo系列">hexo系列<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Java集合/" title="Java集合">Java集合<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Linux命令/" title="Linux命令">Linux命令<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Otter/" title="Otter">Otter<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MyCat/" title="MyCat">MyCat<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.xskh.club" target="_blank" title="向山看海 Blog">向山看海 Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Less is more. <br/>
			</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="cclouds">cclouds</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>







<script type="text/javascript">

var disqus_shortname = 'cclouds';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261820105'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1261820105' type='text/javascript'%3E%3C/script%3E"));</script>

<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

  </body>
</html>
